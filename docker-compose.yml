version: '3.8'

services:
  # --- 1. MySQL æœåŠ¡ ---
  mysql:
    image: mysql:8.0
    container_name: coupon-mysql
    environment:
      MYSQL_ROOT_PASSWORD: 1234  # âš ï¸ å¯¹åº”ä½ ä»£ç é‡Œçš„å¯†ç 
      MYSQL_DATABASE: coupon     # âš ï¸ è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸º coupon çš„åº“
    ports:
      - "3307:3306"              # æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œæ–¹ä¾¿ä½ ç”¨ Navicat/DBeaver è¿æ¥
    volumes:
      - ./db_data:/var/lib/mysql # æ•°æ®æŒä¹…åŒ–ï¼šæŠŠæ•°æ®å­˜åœ¨å½“å‰ç›®å½•çš„ db_data æ–‡ä»¶å¤¹ä¸‹ï¼Œé˜²æ­¢é‡å¯ä¸¢æ•°æ®
    command: --default-authentication-plugin=mysql_native_password # è§£å†³éƒ¨åˆ†å®¢æˆ·ç«¯è¿æ¥æŠ¥é”™é—®é¢˜

  # --- 2. Redis æœåŠ¡ ---
  redis:
    image: redis:alpine
    container_name: coupon-redis
    ports:
      - "6379:6379"
    volumes:
      - ./redis_data:/data

  # --- 3. Spring Boot åº”ç”¨ ---
  app:
    build: .                     # ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile æ„å»ºé•œåƒ
    container_name: coupon-app
    ports:
      - "8081:8081"              # å¯¹å¤–æš´éœ²ç«¯å£
    depends_on:                  # ç¡®ä¿ MySQL å’Œ Redis å…ˆå¯åŠ¨
      - mysql
      - redis
    environment:
      # ğŸ”¥ æ ¸å¿ƒç½‘ç»œé…ç½®ï¼šè¦†ç›– application.yml ä¸­çš„é…ç½®
      # åœ¨ Docker Compose ç½‘ç»œä¸­ï¼Œç›´æ¥å†™æœåŠ¡å "mysql" å’Œ "redis" å³å¯è®¿é—®
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/coupon?useUnicode=true&characterEncoding=utf-8&serverTimezone=Asia/Shanghai
      SPRING_DATASOURCE_USERNAME: root
      SPRING_DATASOURCE_PASSWORD: 1234
      SPRING_DATA_REDIS_HOST: redis  # è¿™é‡Œå¡«ä¸Šé¢å®šä¹‰çš„æœåŠ¡å "redis"